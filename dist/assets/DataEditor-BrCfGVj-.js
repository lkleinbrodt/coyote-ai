import{r as c,j as e,C as D,x as I,y as U,D as N,a4 as k,a2 as P,v as A,a5 as M,a6 as O,a7 as T,a8 as v,a9 as L,w as R,R as H,aa as y,ab as $}from"./index-D4RshzJg.js";import{L as z,D as B,a as W,b as _,c as q,d as G,e as J,f as K,g as Q}from"./DragDropFileInput-DaZrVawj.js";import{P as V}from"./label-0LwoJz5F.js";const X=({file:s,onDelete:u})=>{const[n,r]=c.useState(!1),h=a=>new Date(a).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),d=async()=>{try{r(!0),await u(s.id)}catch(a){console.error("Error deleting file:",a),r(!1),O({title:"Error deleting file",description:a instanceof Error?a.message:"An unknown error occurred",variant:"destructive"})}finally{r(!1)}};return e.jsxs(D,{className:"flex flex-col truncate",children:[e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{className:"truncate flex-grow py-2",children:s.name}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 ml-2 flex-shrink-0",onClick:d,disabled:n,children:n?e.jsx(z,{className:"h-4 w-4 animate-spin"}):e.jsx(k,{className:"h-4 w-4"})})]}),e.jsxs(P,{className:"text-xs text-muted-foreground",children:["Uploaded: ",h(s.created_at)]})]}),e.jsx(A,{className:"flex items-center justify-center",children:e.jsx(M,{className:"w-10 h-10"})})]},s.id)};function Y({projectID:s,setAvailableFiles:u,uploading:n,setUploading:r,updateIndexOnUpload:h}){const[d,a]=c.useState(null),[t,x]=c.useState(null),[j,g]=c.useState(null),[S,w]=c.useState(!1),{toast:F}=T(),C=async m=>{if(!m||m.length===0){a("Please select at least one file to upload.");return}r(!0),g(0);const b=Array.from(m).map(l=>v(l,s).then(o=>(g(i=>(i||0)+1/m.length),o)).catch(o=>{if(o.response&&o.response.status===409){if(window.confirm(`File ${l.name} already exists. Do you want to overwrite it?`))return v(l,s,!0).then(p=>(g(f=>(f||0)+1/m.length),p));throw new Error("Upload cancelled")}throw o}));Promise.all(b).then(l=>{x(`${l.length} file(s) uploaded successfully`),a(null),u(o=>{const i=[...o];return l.forEach(p=>{const f=i.findIndex(E=>E.name===p.name);f!==-1?i[f]=p:i.push(p)}),i})}).catch(l=>{a("An error occurred while uploading one or more files."),console.error("Error uploading files:",l)}).then(()=>{h&&L(s)}).finally(()=>{r(!1),w(!1),F({title:"Files uploaded successfully"})})};return e.jsxs(B,{open:S,onOpenChange:w,children:[e.jsx(W,{children:e.jsx(N,{onClick:()=>w(!0),children:"Upload Sources"})}),e.jsxs(_,{className:"mx-auto w-full max-w-6xl",children:[e.jsxs(q,{children:[e.jsx(G,{className:"text-5xl",children:"Upload Sources"}),e.jsx(J,{className:"text-xl",children:e.jsx("div",{children:"Sources let AutoDraft base its answers on specific documents (like project updates, annual reports, financial statements, etc.)"})})]}),e.jsx("div",{className:"flex flex-col gap-4 items-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsx(K,{onFileChange:C,isUploading:n,uploadProgress:j??void 0}),d&&e.jsx("p",{style:{color:"red"},children:d}),t&&e.jsx("p",{style:{color:"green"},children:t})]})}),e.jsx(Q,{})]})]})}const ae=()=>{const{selectedProject:s,availableFiles:u,setAvailableFiles:n}=R(),[r,h]=c.useState(!1),[d]=c.useState(!1),a=async t=>{try{await $(t),n(x=>x.filter(j=>j.id!==t))}catch(x){throw console.error("Error deleting file:",x),x}};return s?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 justify-between",children:[e.jsx(Y,{projectID:s==null?void 0:s.id,setAvailableFiles:n,setUploading:h,updateIndexOnUpload:!0,uploading:r}),e.jsx("div",{children:d?e.jsxs(N,{disabled:!0,children:[e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Index"]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Source Files"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[u.map(t=>e.jsx(X,{file:t,onDelete:a},t.id)),r&&e.jsxs(D,{children:[e.jsx(y,{className:"h-5 grow m-2"}),e.jsx(y,{className:"h-5 grow m-2 mr-10"}),e.jsx("div",{className:"flex items-center justify-center h-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gray-900"})})]})]})]})]})}):e.jsx("div",{children:e.jsx(V,{title:"No project selected",description:"Select a project to get started."})})};export{ae as default};
