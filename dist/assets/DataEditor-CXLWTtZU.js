import{r as i,j as e,C as v,x as A,y as I,D as N,a5 as k,a3 as U,v as P,a6 as T,a7 as M,a8 as O,a9 as y,aa as L,w as R,R as H,V as W,W as $,ab as z,Y as B,Z as V,ac as D,ad as Y}from"./index-BZtEtTms.js";import{L as Z,D as _,a as q,b as G,c as J,d as K,e as Q,f as X,g as ee}from"./DragDropFileInput-ChmTqcEY.js";import{P as se}from"./label-DslQTc7R.js";const ae=({file:s,onDelete:d})=>{const[n,r]=i.useState(!1),m=a=>new Date(a).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),u=async()=>{try{r(!0),await d(s.id)}catch(a){console.error("Error deleting file:",a),r(!1),M({title:"Error deleting file",description:a instanceof Error?a.message:"An unknown error occurred",variant:"destructive"})}finally{r(!1)}};return e.jsxs(v,{className:"flex flex-col truncate",children:[e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{className:"truncate flex-grow py-2",children:s.name}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8 ml-2 flex-shrink-0",onClick:u,disabled:n,children:n?e.jsx(Z,{className:"h-4 w-4 animate-spin"}):e.jsx(k,{className:"h-4 w-4"})})]}),e.jsxs(U,{className:"text-xs text-muted-foreground",children:["Uploaded: ",m(s.created_at)]})]}),e.jsx(P,{className:"flex items-center justify-center",children:e.jsx(T,{className:"w-10 h-10"})})]},s.id)};function re({projectID:s,setAvailableFiles:d,uploading:n,setUploading:r,updateIndexOnUpload:m}){const[u,a]=i.useState(null),[t,x]=i.useState(null),[j,g]=i.useState(null),[S,w]=i.useState(!1),{toast:C}=O(),F=async h=>{if(!h||h.length===0){a("Please select at least one file to upload.");return}r(!0),g(0);const b=Array.from(h).map(l=>y(l,s).then(o=>(g(c=>(c||0)+1/h.length),o)).catch(o=>{if(o.response&&o.response.status===409){if(window.confirm(`File ${l.name} already exists. Do you want to overwrite it?`))return y(l,s,!0).then(p=>(g(f=>(f||0)+1/h.length),p));throw new Error("Upload cancelled")}throw o}));Promise.all(b).then(l=>{x(`${l.length} file(s) uploaded successfully`),a(null),d(o=>{const c=[...o];return l.forEach(p=>{const f=c.findIndex(E=>E.name===p.name);f!==-1?c[f]=p:c.push(p)}),c})}).catch(l=>{a("An error occurred while uploading one or more files."),console.error("Error uploading files:",l)}).then(()=>{m&&L(s)}).finally(()=>{r(!1),w(!1),C({title:"Files uploaded successfully"})})};return e.jsxs(_,{open:S,onOpenChange:w,children:[e.jsx(q,{children:e.jsx(N,{onClick:()=>w(!0),children:"Upload Sources"})}),e.jsxs(G,{className:"mx-auto w-full max-w-6xl",children:[e.jsxs(J,{children:[e.jsx(K,{className:"text-5xl",children:"Upload Sources"}),e.jsx(Q,{className:"text-xl",children:e.jsx("div",{children:"Sources let AutoDraft base its answers on specific documents (like project updates, annual reports, financial statements, etc.)"})})]}),e.jsx("div",{className:"flex flex-col gap-4 items-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsx(X,{onFileChange:F,isUploading:n,uploadProgress:j??void 0}),u&&e.jsx("p",{style:{color:"red"},children:u}),t&&e.jsx("p",{style:{color:"green"},children:t})]})}),e.jsx(ee,{})]})]})}const oe=()=>{const{selectedProject:s,availableFiles:d,setAvailableFiles:n}=R(),[r,m]=i.useState(!1),[u]=i.useState(!1),a=async t=>{try{await Y(t),n(x=>x.filter(j=>j.id!==t))}catch(x){throw console.error("Error deleting file:",x),x}};return s?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 justify-center",children:[e.jsx(re,{projectID:s==null?void 0:s.id,setAvailableFiles:n,setUploading:m,updateIndexOnUpload:!0,uploading:r}),e.jsx("div",{children:u?e.jsxs(N,{disabled:!0,children:[e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Index"]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Source Files"}),d.length===0&&e.jsxs(W,{className:"my-4",children:[e.jsx($,{icon:z}),e.jsx(B,{children:"No source files yet"}),e.jsx(V,{className:"text-muted-foreground",children:"Sources let AutoDraft base its answers on specific documents (like project updates, annual reports, financial statements, etc.)"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[d.map(t=>e.jsx(ae,{file:t,onDelete:a},t.id)),r&&e.jsxs(v,{children:[e.jsx(D,{className:"h-5 grow m-2"}),e.jsx(D,{className:"h-5 grow m-2 mr-10"}),e.jsx("div",{className:"flex items-center justify-center h-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gray-900"})})]})]})]})]})}):e.jsx("div",{children:e.jsx(se,{title:"No project selected",description:"Select a project to get started."})})};export{oe as default};
